# 데이터
## 애플리케이션
- 코드 + 환경
- 개발자에 의해 작성되고 제공된다.
- 빌드 단계에서 이미지와 컨테이너에 추가된다.
- "고정": 이미지가 빌드되면 변경할 수 없다.
- 읽기 전용, 따라서 *이미지*에 저장된다.

## 임시 앱 데이터
- 예: 입력된 사용자 입력
- 동작 중인 컨테이너에서 가져오거나 생성된다.
- 메모리 또는 임시 파일에 저장된다.
- 동적이고 변화하지만 정기적으로 제거된다.
- 읽기 + 쓰기, 임시, 그러므로 *컨테이너*에 저장된다.

## 영구 앱 데이터
- 예: 사용자 계정
- 동작 중인 컨테이너에서 가져오거나 생성된다.
- 파일 또는 데이터베이스에 저장된다.
- 컨테이너가 정지하거나 재시작 되었을 때 손실되어서는 안 된다.
- 읽기 + 쓰기, 영구적, *컨테이너*와 *볼륨*에 저장된다.

# 볼륨
- 컨테이너에 마운트("made available", mapped)된 호스트 머신의 하드 드라이브에 있는 폴더
- 컨테이너가 종료되어도 남아있다.
- 컨테이너가 (재)시작되고 볼륨을 마운트하면, 그 볼륨 안에 있는 데이터는 컨테이너에서 사용할 수 있게 된다.
- 컨테이너는 볼륨에 데이터를 쓸 수 있고, 볼륨의 데이터를 읽을 수 있다.

# 외장 데이터 스토리지의 두 종류
![볼륨과 바인드 바운트 비교](./image/volume-bindmount.png)

# 컨테이너/볼륨 상호작용 이해하기
- 볼륨은 컨테이너에 마운트된다.
- 컨테이너 데이터는 볼륨에 저장된다.
- 볼륨 데이터는 컨테이너에서 접근할 수 있다.

# 볼륨과 바인드 마운트
| 명령어 | 결과 |
| --- | --- |
| `docker run -v /app/data ...` | 익명 볼륨 |
| `docker run -v data:/app/data ...` | 명명된 볼륨 |
| `docker run -v /path/to/code:/app/code ...` | 바인드 마운트 |

# 볼륨: 비교
| 익명 볼륨 | 명명된 볼륨 | 바인드 마운트 |
| --- | --- | --- |
| 한 개의 컨테이너를 위해 특별히 생성된다 | 범용으로 생성된다 - 특정 컨테이너에 매여있지 않다 | 호스트 파일 시스템에 위치하며, 특정 컨테이너에 매여있지 않다 |
| `--rm`이 사용되지 않았다면 컨테이너를 종료하거나 재시작해도 남아있다 | 컨테이너가 종료 / 재시작 되어도 남아있다 - 도커 CLI를 통해 제거할 수 있다 | 컨테이너가 종료 / 재시작 되어도 남아있다 - 호스트 파일 시스템에서 제거할 수 있다 |
| 여러 컨테이너에 걸쳐 공유할 수 없다 | 여러 컨테이너에 걸쳐 공유할 수 있다 | 여러 컨테이너에 걸쳐 공유할 수 있다 |
| 익명이므로 재사용 될 수 없다 (같은 이미지에서라도) | 같은 컨테이너에서 재사용 될 수 있다 (재시작) | 같은 컨테이너에서 재사용 될 수 있다 (재시작) |

# ARGuments & ENVironment Variables
도커는 빌드타임 ARGument와 런타임 ENVironment 변수를 지원한다.

| ARG | ENV |
| --- | --- |
| CMD 또는 애플리케이션 코드에서는 접근할 수 없고, Dockerfile 내에서 사용할 수 있다 | Dockerfile 내부와 애플리케이션 코드에서 사용할 수 있다 |
| `--build-arg`를 통해 이미지 빌드(`docker build`)에서 설정한다 | Dockerfile의 `ENV` 또는 `docker run`의 `--env`를 통해 설정한다 |

# 모듈 요약
- 컨테이너는 데이터를 읽고 쓸 수 있다. 볼륨은 데이터 저장, 바인드 마운트는 직접적인 컨테이너 상호작용에 도움을 준다.
- 컨테이너는 데이터를 읽고 쓸 수 있지만 컨테이너가 제거되면 데이터를 잃게 된다.
- 볼륨은 컨테이너에 마운트되며 도커가 관리하는 호스트 머신에 있는 폴더이다.
- 명명된 볼륨은 컨테이너가 삭제되어도 남아있기 때문에 영구적인 데이터를 저장하는데 사용된다.
- 익명 볼륨은 컨테이너에 부착된다. 컨테이너 안의 (임시) 데이터를 저장하는데 사용된다.
- 바인드 마운트는 명명된 볼륨처럼 사용자에 의해 명시되고 컨테이너에 마운트되는 호스트 머신의 폴더이다.
- 빌드 인자와 런타임 환경 변수는 이미지와 컨테이너를 더 동적이고 / 설정 가능하게 하기 위해 사용된다.

# 읽기 전용, 읽기와 쓰기, 볼륨
| 이미지 | 컨테이너 |
| --- | --- |
| 읽기 전용 | 읽기, 쓰기 |
| 한 번 생성되면 무언가 변경하기 위해서는 다시 빌드해야 한다 | 동작하는 컨테이너는 데이터를 저장할 수 있다 (예: 들어오는 사용자 데이터)
| 애플리케이션 데이터(예: 사용자 데이터)는 이미지에 저장되지 않는다. | 그러나: 컨테이너가 멈추면 데이터가 손실된다 |

영속적인 데이터를 위한 해결법: 볼륨